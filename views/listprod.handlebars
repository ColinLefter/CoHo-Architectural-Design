<div class="bg-white dark:bg-black">
  <div class="mx-auto max-w-7xl px-4 py-24 sm:px-6 sm:py-8 lg:px-8">
    <h1 class="text-3xl font-bold tracking-tight text-black dark:text-white">Product Catalogue</h1>

    <div style="margin-top: 20px;"> <!-- Adding space -->

    <!-- Container for both search and product list -->
    <div class="flex flex-col gap-6">

      <!-- Search Form -->
      <form action="/listprod" method="get" class="w-full">
        <div class="flex items-center">
          <!-- Search Input -->
          <input type="text" name="productName" placeholder="Search for a product" class="border-2 border-gray-300 rounded-lg p-2 flex-grow" value="{{searchValue}}">

          <!-- Buttons -->
          <div class="ml-2 flex items-center">
            <input type="submit" value="Submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            <input type="reset" value="Reset" class="bg-gray-300 hover:bg-gray-400 text-black dark:text-white py-2 px-4 rounded ml-1">
          </div>
        </div>
      </form>
      
      <h2 class="text-2xl font-bold tracking-tight text-black dark:text-white">All Products</h2>

      <!-- Product List -->
      <div class="divide-y divide-gray-200">
        {{#each products}}
          <div class="flex items-center py-4">
            <!-- Product Image -->
            <div class="flex-shrink-0 w-32 h-32">
              <img src="{{displayOne}}" alt="{{productName}}" class="h-full w-full object-cover rounded-lg">
            </div>
            <!-- Product Details -->
            <div class="ml-4 flex-grow">
              <h3 class="text-lg font-bold">{{productName}}</h3>
              <p class="text-gray-500 dark:text-white">{{categoryName}}</p>
              <p class="text-gray-500 dark:text-white">${{formattedPrice}}</p>
            </div>
            <!-- Add to Cart Link -->
            <a href="#" onclick="addToCart('{{productId}}', '{{productName}}', '{{productPrice}}')" class="text-blue-600 hover:text-blue-800 ml-4">Add to cart</a>
          </div>
        {{/each}}
      </div>

    </div> <!-- End of container for search and product list -->
  </div>
</div>


<!-- Cart Modal -->
<div id="cartModal" style="display:none;" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-black">
    <div id="cartContainer"></div>
    <button onclick="closeCartModal()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Close Cart</button>
  </div>
</div>

<script>
    function showCartModal(html) {
        document.getElementById('cartContainer').innerHTML = html;
        document.getElementById('cartModal').style.display = 'block';
    }

    function closeCartModal() {
        document.getElementById('cartModal').style.display = 'none';
    }

    function addToCart(productId, productName, productPrice) {
        // Prevent the default link behavior
        event.preventDefault();

        let fetchUrl = `/addcart?id=${encodeURIComponent(productId)}&name=${encodeURIComponent(productName)}&price=${encodeURIComponent(productPrice)}`;

        fetch(fetchUrl)
            .then(response => response.text())
            .then(html => {
                showCartModal(html);
            })
            .catch(error => console.error('Error:', error));
    }
</script>