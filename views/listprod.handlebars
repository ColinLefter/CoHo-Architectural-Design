<div style="margin-top: 20px;"> <!-- Adding space -->

<h1>Search for the products you want to buy:</h1>


<style>
  table {
    border-collapse: collapse;
    width: 90%;
  }

  table, th, td {
    border: 5px solid #ddd;
  }

  th, td {
    padding: 10px;
    text-align: left;
  }
</style>

<table>
  <tr>
    <td colspan="2">
      <form action="/listprod" method="get">
        <input type="text" name="productName" placeholder="Search for a product" size="50" value="{{searchValue}}">
      </td>
      <td>
        <input type="submit" value="Submit">
      </td>
      <td>
        <input type="reset" value="Reset"><small> (Leave blank for all products)</small>
      </td>
    </tr>
  </form>
</table>


<h2>All Products</h2>
<table border='1' cellpadding='10'>
  <tr>
    <th></th>
    <th>Product Name</th>
    <th>Category</th>
    <th>Product Price</th>
  </tr>
  <div id="cartModal" style="display:none;">
    <div id="cartContainer"></div>
    <button onclick="closeCartModal()">Close Cart</button>
  </div>
  {{#each products}}
  <tr>
      <td><a href="#" class="addToCartLink" data-product-id="{{productId}}" data-product-name="{{productName}}" data-product-price="{{productPrice}}">Add to cart</a></td>
      <td><a href="/product?id={{productId}}&name={{productName}}&price={{productPrice}}">{{productName}}</a></td>
      <td>{{categoryName}}</td>
      <td>{{formattedPrice}}</td>
  </tr>
  {{/each}}

  <script>
      let productCounts = {}; // Object to keep track of items added to the cart for each product

      document.querySelectorAll('.addToCartLink').forEach(link => {
          link.addEventListener('click', function(e) {
              e.preventDefault();
              let productId = this.getAttribute('data-product-id');

              // Initialize the count for the product if it doesn't exist
              if (!productCounts[productId]) {
                  productCounts[productId] = 0;
              }

              let productName = this.getAttribute('data-product-name');
              let productPrice = this.getAttribute('data-product-price');

              let fetchUrl = `/addcart?id=${encodeURIComponent(productId)}&name=${encodeURIComponent(productName)}&price=${encodeURIComponent(productPrice)}`;

              fetch(fetchUrl)
                  .then(response => {
                      if (response.ok) {
                          productCounts[productId]++; // Increment item count for this product
                          this.textContent = 'Items in cart: ' + productCounts[productId]; // Update link text for this product
                      } else {
                          // Handle response error
                          console.error('Error:', response.statusText);
                          this.textContent = 'Error adding to cart';
                      }
                  })
                  .catch(error => {
                      console.error('Error:', error);
                      this.textContent = 'Error adding to cart';
                  });
          });
      });
  </script>
</table>
</div>